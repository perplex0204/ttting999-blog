---
title: 'Moniit - å¤šå…ƒè³‡ç”¢ç®¡ç†æ‡‰ç”¨'
description: 'æ•´åˆè‚¡ç¥¨ã€åŠ å¯†è²¨å¹£ã€è²´é‡‘å±¬ã€å¤–åŒ¯ç­‰å¤šå…ƒè³‡ç”¢çš„æ™ºèƒ½ç®¡ç†æ‡‰ç”¨ï¼Œæä¾›å³æ™‚å ±åƒ¹ã€è‡ªå‹•åŒ–è³‡ç”¢è¿½è¹¤èˆ‡æŠ•è³‡çµ„åˆåˆ†æ'
date: '2025-04-01'
tags: ['TypeScript', 'Node.js', 'PostgreSQL', 'Redis', 'WebSocket', 'Design Patterns']
github: ''
demo: ''
image: ''
featured: true
---

## å°ˆæ¡ˆæ¦‚è¿°

Moniit æ˜¯ä¸€æ¬¾è·¨è³‡ç”¢é¡åˆ¥çš„æ™ºèƒ½è³‡ç”¢ç®¡ç†æ‡‰ç”¨ï¼Œæ—¨åœ¨è§£æ±ºç¾ä»£æŠ•è³‡è€…é¢è‡¨çš„å¤šå¹³å°å¸³æˆ¶ç®¡ç†å›°æ“¾ã€‚ç³»çµ±æ•´åˆäº†**è‚¡ç¥¨ã€åŠ å¯†è²¨å¹£ã€è²´é‡‘å±¬ã€å¤–åŒ¯**ç­‰å¤šç¨®é‡‘èç”¢å“çš„ APIï¼Œæä¾›çµ±ä¸€çš„è³‡ç”¢æª¢è¦–èˆ‡åˆ†æä»‹é¢ï¼Œè®“ä½¿ç”¨è€…èƒ½å¤ å…¨é¢æŒæ¡è‡ªå·±çš„æŠ•è³‡çµ„åˆã€‚

## æ ¸å¿ƒåŠŸèƒ½

### å¤šè³‡ç”¢æ•´åˆ

- **è‚¡ç¥¨å¸‚å ´**ï¼šæ”¯æ´å°è‚¡ã€ç¾è‚¡ã€æ¸¯è‚¡ç­‰å…¨çƒä¸»è¦å¸‚å ´
- **åŠ å¯†è²¨å¹£**ï¼šæ•´åˆ Binance, Coinbase ç­‰ä¸»æµäº¤æ˜“æ‰€
- **è²´é‡‘å±¬**ï¼šé»ƒé‡‘ã€ç™½éŠ€ã€é‰‘é‡‘ç­‰å³æ™‚å ±åƒ¹
- **å¤–åŒ¯å¸‚å ´**ï¼šä¸»è¦è²¨å¹£å°å³æ™‚åŒ¯ç‡

### å³æ™‚å ±åƒ¹å¼•æ“

- **é«˜é »æ›´æ–°**ï¼šé€é WebSocket æä¾›å³æ™‚å ±åƒ¹æ¨é€
- **å¤§è¦æ¨¡æ¨™çš„æ”¯æ´**ï¼šå–®ä¸€å¼•æ“å¯åŒæ™‚è™•ç† **15,000+** å€‹äº¤æ˜“æ¨™çš„
- **æ™ºèƒ½æ’ç¨‹å™¨**ï¼šæ ¹æ“šå¸‚å ´é–‹ç›¤æ™‚é–“è‡ªå‹•èª¿æ•´æ›´æ–°é »ç‡
- **ä½µç™¼å„ªåŒ–**ï¼šæ¡ç”¨éåŒæ­¥ä¸¦è¡Œæ¶æ§‹ï¼Œæœ€å¤§åŒ–ååé‡

### æŠ•è³‡çµ„åˆç®¡ç†

- **å¤šå¸³æˆ¶æ”¯æ´**ï¼šçµ±ä¸€ç®¡ç†å¤šå€‹åˆ¸å•†/äº¤æ˜“æ‰€å¸³æˆ¶
- **è‡ªå‹•åŒæ­¥**ï¼šå®šæœŸè‡ªå‹•æŠ“å–å¸³æˆ¶é¤˜é¡èˆ‡æŒå€‰
- **æç›Šåˆ†æ**ï¼šå³æ™‚è¨ˆç®—ç¸½è³‡ç”¢åƒ¹å€¼ã€æœªå¯¦ç¾æç›Šã€å·²å¯¦ç¾æç›Š
- **æ­·å²è¿½è¹¤**ï¼šè¨˜éŒ„è³‡ç”¢è®ŠåŒ–æ­·ç¨‹ï¼Œæä¾›ç¸¾æ•ˆåˆ†æ

### æ™ºèƒ½é€šçŸ¥

- **åƒ¹æ ¼è­¦ç¤º**ï¼šè¨­å®šç›®æ¨™åƒ¹æ ¼ï¼Œé”æ¨™æ™‚è‡ªå‹•é€šçŸ¥
- **æ–°èè¿½è¹¤**ï¼šè¨‚é–±ç‰¹å®šæ¨™çš„çš„ç›¸é—œæ–°è
- **ç•°å¸¸åµæ¸¬**ï¼šåµæ¸¬å¸³æˆ¶ç•°å¸¸äº¤æ˜“æˆ–å¤§å¹…æ³¢å‹•

## æŠ€è¡“æ¶æ§‹

### è¨­è¨ˆæ¨¡å¼é©…å‹•é–‹ç™¼

Moniit çš„æ ¸å¿ƒæ¶æ§‹æ¡ç”¨**å·¥å» æ¨¡å¼ (Factory Pattern)** èˆ‡**ç­–ç•¥æ¨¡å¼ (Strategy Pattern)**ï¼Œå¯¦ç¾é«˜åº¦è§£è€¦èˆ‡å¯æ“´å±•æ€§ã€‚

#### å·¥å» æ¨¡å¼ - è³‡ç”¢é¡åˆ¥æŠ½è±¡

```typescript
// è³‡ç”¢é¡åˆ¥ä»‹é¢
interface Asset {
  getPrice(): Promise<number>;
  getBalance(accountId: string): Promise<number>;
  executeOrder(order: Order): Promise<OrderResult>;
}

// è³‡ç”¢å·¥å» 
class AssetFactory {
  static create(type: AssetType): Asset {
    switch (type) {
      case AssetType.STOCK:
        return new StockAsset();
      case AssetType.CRYPTO:
        return new CryptoAsset();
      case AssetType.PRECIOUS_METAL:
        return new PreciousMetalAsset();
      case AssetType.FOREX:
        return new ForexAsset();
      default:
        throw new Error(`Unsupported asset type: ${type}`);
    }
  }
}
```

**å„ªå‹¢**ï¼š
- âœ… æ–°å¢è³‡ç”¢é¡åˆ¥æ™‚ï¼Œåªéœ€å¯¦ä½œ `Asset` ä»‹é¢ï¼Œç„¡éœ€ä¿®æ”¹æ—¢æœ‰ç¨‹å¼ç¢¼
- âœ… ç¬¦åˆé–‹æ”¾å°é–‰åŸå‰‡ (Open-Closed Principle)
- âœ… é™ä½æ¨¡çµ„é–“è€¦åˆåº¦

#### ç­–ç•¥æ¨¡å¼ - å ±åƒ¹ä¾†æºç­–ç•¥

```typescript
// å ±åƒ¹ç­–ç•¥ä»‹é¢
interface PricingStrategy {
  fetchPrice(symbol: string): Promise<number>;
}

// Yahoo Finance ç­–ç•¥
class YahooFinancePricing implements PricingStrategy {
  async fetchPrice(symbol: string): Promise<number> {
    // Yahoo Finance API å¯¦ä½œ
  }
}

// Alpha Vantage ç­–ç•¥
class AlphaVantagePricing implements PricingStrategy {
  async fetchPrice(symbol: string): Promise<number> {
    // Alpha Vantage API å¯¦ä½œ
  }
}

// å ±åƒ¹æœå‹™
class PricingService {
  constructor(private strategy: PricingStrategy) {}

  async getPrice(symbol: string): Promise<number> {
    return this.strategy.fetchPrice(symbol);
  }

  // å‹•æ…‹åˆ‡æ›ç­–ç•¥
  setStrategy(strategy: PricingStrategy) {
    this.strategy = strategy;
  }
}
```

**å„ªå‹¢**ï¼š
- âœ… å¯æ ¹æ“š API å¯ç”¨æ€§å‹•æ…‹åˆ‡æ›å ±åƒ¹ä¾†æº
- âœ… æ˜“æ–¼æ¸¬è©¦ï¼ˆå¯æ³¨å…¥ Mock ç­–ç•¥ï¼‰
- âœ… ç¬¦åˆä¾è³´åè½‰åŸå‰‡ (Dependency Inversion Principle)

### å³æ™‚å ±åƒ¹å¼•æ“è¨­è¨ˆ

**æŒ‘æˆ°**ï¼šå¦‚ä½•é«˜æ•ˆè™•ç† 15,000+ å€‹æ¨™çš„çš„å³æ™‚å ±åƒ¹ï¼Ÿ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. **æ’ç¨‹å™¨ (Scheduler)**ï¼šæ ¹æ“šå¸‚å ´é–‹ç›¤æ™‚é–“è‡ªå‹•å•Ÿåœå ±åƒ¹æœå‹™
2. **ä¸¦è¡Œè™•ç†**ï¼šä½¿ç”¨ Node.js Worker Threads é€²è¡Œ CPU å¯†é›†é‹ç®—
3. **æ‰¹æ¬¡è«‹æ±‚**ï¼šå°‡æ¨™çš„åˆ†çµ„ï¼Œæ‰¹æ¬¡å‘¼å« API é™ä½è«‹æ±‚æ¬¡æ•¸
4. **å¿«å–æ©Ÿåˆ¶**ï¼šRedis å¿«å–å ±åƒ¹è³‡æ–™ï¼Œæ¸›å°‘ API å‘¼å«é »ç‡

```typescript
class RealtimePricingEngine {
  private scheduler: NodeSchedule;
  private redis: RedisClient;
  private workerPool: WorkerPool;

  async start() {
    // æ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡å ±åƒ¹
    this.scheduler.scheduleJob('*/5 * * * * *', async () => {
      const symbols = await this.getActiveSymbols(); // 15,000+ æ¨™çš„
      const batches = this.chunk(symbols, 100); // åˆ†æ‰¹è™•ç†

      // ä¸¦è¡Œè™•ç†å„æ‰¹æ¬¡
      await Promise.all(
        batches.map(batch => this.workerPool.execute({
          task: 'fetchPrices',
          data: batch
        }))
      );
    });
  }

  private async getActiveSymbols(): Promise<string[]> {
    // åªæ›´æ–°ç”¨æˆ¶æœ‰é—œæ³¨çš„æ¨™çš„
    return this.redis.smembers('active_symbols');
  }
}
```

**æ•ˆèƒ½æŒ‡æ¨™**ï¼š
- âš¡ 15,000 å€‹æ¨™çš„å…¨é‡æ›´æ–°æ™‚é–“ < 10 ç§’
- âš¡ å–®ä¸€æ¨™çš„å¹³å‡å ±åƒ¹å»¶é² < 2 ç§’
- âš¡ ç³»çµ±è¨˜æ†¶é«”ä½”ç”¨ < 512 MB

### å¾Œç«¯æŠ€è¡“æ£§

- **Node.js + TypeScript**ï¼šå‹åˆ¥å®‰å…¨ã€é–‹ç™¼æ•ˆç‡é«˜
- **Express.js**ï¼šè¼•é‡ç´š Web æ¡†æ¶
- **PostgreSQL**ï¼šå„²å­˜ç”¨æˆ¶è³‡æ–™ã€äº¤æ˜“è¨˜éŒ„ã€æŒå€‰è³‡è¨Š
- **Redis**ï¼š
  - å¿«å–å ±åƒ¹è³‡æ–™
  - å„²å­˜ç”¨æˆ¶ Session
  - å¯¦ä½œåˆ†æ•£å¼é–
  - è¨Šæ¯ä½‡åˆ— (Pub/Sub)
- **WebSocket (Socket.IO)**ï¼šå³æ™‚å ±åƒ¹æ¨é€
- **Bull Queue**ï¼šè™•ç†éåŒæ­¥ä»»å‹™ï¼ˆå¸³æˆ¶åŒæ­¥ã€é€šçŸ¥ç™¼é€ï¼‰

### è³‡æ–™åº«è¨­è¨ˆ

**PostgreSQL Schema è¨­è¨ˆé‡é»**ï¼š

```sql
-- è³‡ç”¢å¸³æˆ¶è¡¨
CREATE TABLE accounts (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES users(id),
    asset_type VARCHAR(20), -- stock, crypto, precious_metal, forex
    provider VARCHAR(50),   -- binance, coinbase, fubon, etc.
    api_key_encrypted TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- æŒå€‰è¡¨
CREATE TABLE positions (
    id UUID PRIMARY KEY,
    account_id UUID REFERENCES accounts(id),
    symbol VARCHAR(20),
    quantity DECIMAL(20, 8),
    avg_cost DECIMAL(20, 8),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(account_id, symbol)
);

-- äº¤æ˜“è¨˜éŒ„è¡¨
CREATE TABLE transactions (
    id UUID PRIMARY KEY,
    account_id UUID REFERENCES accounts(id),
    symbol VARCHAR(20),
    type VARCHAR(10), -- buy, sell
    quantity DECIMAL(20, 8),
    price DECIMAL(20, 8),
    fee DECIMAL(20, 8),
    executed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW()
);

-- ç‚ºé«˜é »æŸ¥è©¢å»ºç«‹ç´¢å¼•
CREATE INDEX idx_positions_account ON positions(account_id);
CREATE INDEX idx_transactions_account_time ON transactions(account_id, executed_at DESC);
```

### API è¨­è¨ˆ

æ¡ç”¨ **RESTful API** è¨­è¨ˆï¼Œéµå¾ªæ¨™æº– HTTP å‹•è©èˆ‡ç‹€æ…‹ç¢¼ã€‚

**ç¯„ä¾‹ç«¯é»**ï¼š
```
GET    /api/accounts              - å–å¾—ç”¨æˆ¶æ‰€æœ‰å¸³æˆ¶
POST   /api/accounts              - æ–°å¢å¸³æˆ¶
GET    /api/positions             - å–å¾—æ‰€æœ‰æŒå€‰
GET    /api/prices/:symbol        - å–å¾—ç‰¹å®šæ¨™çš„å ±åƒ¹
POST   /api/orders                - ä¸‹å–®
GET    /api/transactions          - å–å¾—äº¤æ˜“è¨˜éŒ„
GET    /api/portfolio/summary     - å–å¾—æŠ•è³‡çµ„åˆæ‘˜è¦
```

### å®‰å…¨æ€§è¨­è¨ˆ

- **API é‡‘é‘°åŠ å¯†**ï¼šä½¿ç”¨ AES-256 åŠ å¯†å„²å­˜ç¬¬ä¸‰æ–¹ API é‡‘é‘°
- **JWT èªè­‰**ï¼šç„¡ç‹€æ…‹ Token èªè­‰æ©Ÿåˆ¶
- **Rate Limiting**ï¼šé˜²æ­¢ API æ¿«ç”¨
- **HTTPS Only**ï¼šå¼·åˆ¶ä½¿ç”¨ TLS åŠ å¯†å‚³è¼¸
- **SQL Injection é˜²è­·**ï¼šä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢
- **CORS é…ç½®**ï¼šé™åˆ¶è·¨åŸŸè«‹æ±‚ä¾†æº

## é–‹ç™¼éç¨‹èˆ‡æŒ‘æˆ°

### 1. API æ•´åˆè¤‡é›œåº¦

**æŒ‘æˆ°**ï¼šä¸åŒè³‡ç”¢é¡åˆ¥çš„ API å·®ç•°æ¥µå¤§ï¼ˆREST vs WebSocket, JSON vs XMLï¼‰ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- å¯¦ä½œ Adapter Pattern çµ±ä¸€ä»‹é¢
- å»ºç«‹ API Mock Server ç”¨æ–¼é–‹ç™¼æ¸¬è©¦
- æ’°å¯«è©³ç´°çš„æ•´åˆæ–‡ä»¶

### 2. ä½µç™¼è™•ç†æ•ˆèƒ½ç“¶é ¸

**æŒ‘æˆ°**ï¼šåˆæœŸç‰ˆæœ¬å–®åŸ·è¡Œç·’è™•ç† 15,000 æ¨™çš„éœ€æ™‚ > 60 ç§’ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- å¼•å…¥ Worker Threads é€²è¡Œ CPU å¯†é›†é‹ç®—
- å¯¦ä½œæ‰¹æ¬¡è«‹æ±‚æ©Ÿåˆ¶
- ä½¿ç”¨ Redis å¿«å–æ¸›å°‘é‡è¤‡è«‹æ±‚

**å„ªåŒ–æˆæœ**ï¼š
- âš¡ è™•ç†æ™‚é–“å¾ 60 ç§’é™è‡³ 10 ç§’ï¼ˆ6x æå‡ï¼‰
- âš¡ CPU ä½¿ç”¨ç‡åˆ†æ•£è‡³å¤šæ ¸å¿ƒ

### 3. è³‡æ–™ä¸€è‡´æ€§

**æŒ‘æˆ°**ï¼šå¤šå€‹éåŒæ­¥ä»»å‹™åŒæ™‚æ›´æ–°åŒä¸€ç­†æŒå€‰è³‡æ–™ï¼Œå¯èƒ½é€ æˆä¸ä¸€è‡´ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ PostgreSQL Transaction ä¿è­‰ ACID ç‰¹æ€§
- å¯¦ä½œ Redis åˆ†æ•£å¼é–é¿å…ç«¶çˆ­æ¢ä»¶
- å¼•å…¥æ¨‚è§€é–æ©Ÿåˆ¶è™•ç†ä½µç™¼æ›´æ–°

```typescript
// Redis åˆ†æ•£å¼é–ç¯„ä¾‹
async function updatePosition(accountId: string, symbol: string) {
  const lockKey = `lock:position:${accountId}:${symbol}`;
  const lock = await redisClient.set(lockKey, 'locked', 'EX', 10, 'NX');

  if (!lock) {
    throw new Error('Unable to acquire lock');
  }

  try {
    // åŸ·è¡Œæ›´æ–°æ“ä½œ
    await db.transaction(async (trx) => {
      // ...
    });
  } finally {
    await redisClient.del(lockKey);
  }
}
```

## å°ˆæ¡ˆæˆæœ

- âœ… æˆåŠŸæ•´åˆ **4 ç¨®è³‡ç”¢é¡åˆ¥**ï¼ˆè‚¡ç¥¨ã€åŠ å¯†è²¨å¹£ã€è²´é‡‘å±¬ã€å¤–åŒ¯ï¼‰
- âœ… æ”¯æ´ **15,000+** å€‹äº¤æ˜“æ¨™çš„å³æ™‚å ±åƒ¹
- âœ… å¹³å‡ API å›æ‡‰æ™‚é–“ < 200ms
- âœ… ç³»çµ±ç©©å®šé‹è¡Œï¼Œå¯ç”¨æ€§ > 99%
- âœ… æ¡ç”¨è¨­è¨ˆæ¨¡å¼ï¼Œæ–°å¢è³‡ç”¢é¡åˆ¥åƒ…éœ€ 1-2 å¤©

## æŠ€è¡“äº®é»

1. **è¨­è¨ˆæ¨¡å¼æ‡‰ç”¨**ï¼šFactory + Strategy å¯¦ç¾é«˜æ“´å±•æ€§æ¶æ§‹
2. **é«˜ä½µç™¼è™•ç†**ï¼šWorker Threads + æ‰¹æ¬¡è«‹æ±‚è™•ç†å¤§è¦æ¨¡è³‡æ–™
3. **å‹åˆ¥å®‰å…¨**ï¼šTypeScript å…¨é¢è¦†è“‹ï¼Œæ¸›å°‘åŸ·è¡Œæ™‚éŒ¯èª¤
4. **å³æ™‚æ€§**ï¼šWebSocket æ¨é€æ©Ÿåˆ¶ï¼Œå ±åƒ¹å»¶é² < 2 ç§’
5. **å¯æ¸¬è©¦æ€§**ï¼šä¾è³´æ³¨å…¥è¨­è¨ˆï¼Œå–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ > 80%

## æœªä¾†è¦åŠƒ

- ğŸ”„ æ•´åˆæ›´å¤šè³‡ç”¢é¡åˆ¥ï¼ˆæˆ¿åœ°ç”¢ã€å‚µåˆ¸ã€åŸºé‡‘ï¼‰
- ğŸ”„ é–‹ç™¼æ‰‹æ©Ÿ APPï¼ˆReact Nativeï¼‰
- ğŸ”„ AI æŠ•è³‡å»ºè­°åŠŸèƒ½
- ğŸ”„ ç¤¾ç¾¤åŠŸèƒ½ï¼ˆæŠ•è³‡çµ„åˆåˆ†äº«ã€è¨è«–å€ï¼‰
- ğŸ”„ è‡ªå‹•å†å¹³è¡¡åŠŸèƒ½

---

**é–‹ç™¼æ™‚é–“**ï¼š2025/04 - Present
**åœ˜éšŠè¦æ¨¡**ï¼šå€‹äººå°ˆæ¡ˆ
**æˆ‘çš„è§’è‰²**ï¼šå…¨ç«¯å·¥ç¨‹å¸« - è² è²¬æ¶æ§‹è¨­è¨ˆã€å¾Œç«¯é–‹ç™¼ã€API æ•´åˆã€DevOps
